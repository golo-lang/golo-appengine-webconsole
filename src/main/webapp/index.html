<!DOCTYPE html>
<!--
  Copyright (C) 2013 Julien Ponge

  Permission is hereby granted, free of charge, to any person obtaining a copy of
  this software and associated documentation files (the "Software"), to deal in
  the Software without restriction, including without limitation the rights to
  use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
  the Software, and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be included in all
  copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
  FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
  COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
  IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->
<html ng-app>

  <head>
    <title>Golo Web Console</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css" rel="stylesheet">
    <link href="http://netdna.bootstrapcdn.com/font-awesome/3.0.2/css/font-awesome.css" rel="stylesheet">    
    <style type="text/css" media="screen">
      body {
        width: 100%;
        height: 100%;
      }
      #editor {
        position: relative;
        width: 100%;
        height: 35em;
        margin-bottom: 1em;
        border: solid 1px #ccc;
      }
      .section {
        margin-top: 1em;
        margin-bottom: 1em;
      }
    </style>
  </head>

  <body>
    <div class="container" ng-controller="ConsoleController">
      
      <div class="row section">
        <div class="btn-group">
          <button class="btn dropdown-toggle" data-toggle="dropdown"><i class="icon-beaker icon-large"></i> Samples <span class="caret"></span></button>
          <ul class="dropdown-menu">
            <li><a href="#" ng-click="load('hello')">Hello world</a></li>
            <li><a href="#" ng-click="load('coin-change')">Coin problem</a></li>
            <li><a href="#" ng-click="load('filter-map-reduce')">Filter / map / reduce</a></li>
            <li><a href="#" ng-click="load('pimp')">Pimps: adding join() to Java lists</a></li>
            <li><a href="#" ng-click="load('matching')">Matching operator</a></li>
            <li><a href="#" ng-click="load('call-me-maybe')">Exceptions and closures</a></li>
            <li><a href="#" ng-click="load('dynamic-object')">Dynamic objects</a></li>            
          </ul>          
        </div>
        <span>
          <a href="http://golo-lang.org/documentation/next/" class="btn"><i class="icon-book icon-large"></i> Golo documentation</a>
        </span>        
        <div class="pull-right">          
          <a href="https://twitter.com/share" class="twitter-share-button" data-via="golo_lang" data-size="large" data-hashtags="gololang">Tweet</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          <div class="g-plus" data-action="share" data-annotation="bubble" data-height="24"></div>
          <script type="text/javascript">
            (function() {
              var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
              po.src = 'https://apis.google.com/js/plusone.js';
              var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
            })();
          </script>
        </div>                
      </div>
      
      <div class="row section">        
        <div id="editor"></div>
        <div>
          <button id="exec-button" class="btn btn-large" ng-click="run()">
            <i id="exec-icon" class="icon-play icon-large"></i> Run (Command+E)            
          </button>          
        </div>        
      </div>
      
      <div class="row section">
        <pre id="output">{{output}}</pre>
        <ul>
          <li>The <code>run</code> function will be executed.</li>
          <li>Its <code>context</code> parameter is an object providing a <code>log</code> method as
          a replacement for the standard <code>println</code> function.</li>
          <li>The return value of <code>run</code> is printed, too.</li>
        </ul>
      </div>
      
      <div class="row section">
        <p><img src="https://developers.google.com/appengine/images/appengine-noborder-120x30.gif" 
alt="Powered by Google App Engine" /></p>
        <p>Golo Web Console. Copyright &copy; 2013 Julien Ponge.</p>
        <p class="muted">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>          
      </div>
      
    </div>
  </body>

<script id="hello" type="text/golo">module test

function run = |context| {
  context: log("Golo World")
}
</script>

<script id="coin-change" type="text/golo">module CoinChange

import java.util.LinkedList

function change = |money, coins| -> match {
  when money == 0 then 1
  when (money < 0) or (coins: isEmpty()) then 0
  otherwise change(money - coins: head(), coins) + change(money, coins: tail())
}

function run = |context| {
  let coins = LinkedList(): append(1, 2, 5, 10, 20)
  context: log("Coins: " + coins)
  context: log("0: " + change(0, coins))
  context: log("1: " + change(1, coins))
  context: log("2: " + change(2, coins))
  context: log("10: " + change(10, coins))
  context: log("12: " + change(12, coins))
  context: log("6: " + change(6, coins))
}
</script>

<script id="filter-map-reduce" type="text/golo">module test

import java.util

function run = |context| {

  let list = LinkedList()
  foreach (i in range(1, 1000)) {
    list: append(i, i * 2, i * 3)
  }

  let sum_of_even_plus_two = list:
    map(|x| -> x + 2):
    filter(|x| -> (x % 2) == 0):
    reduce(0, |acc, x| -> acc + x)

  return sum_of_even_plus_two
}
</script>

<script id="pimp" type="text/golo">module test

import java.lang
import java.util

pimp java.util.List {

  function join = |this, separator| {
    let builder = StringBuilder()
    var first = true
    foreach (element in this) {
      if first {
        builder: append(element)
        first = false
      } else {
        builder: append(separator): append(element)
      }      
    }
    return builder: toString()
  }
}

function run = |context| {
  let list = LinkedList(): append("foo", "bar", "baz")
  return "[" + list: join(", ") + "]"
}
</script>

<script id="matching" type="text/golo">module test

import java.util.LinkedList

local function data = -> LinkedList(): 
  append("foo@bar.com", "+33.6.11.22.33"):
  append("http://golo-lang.org/"):
  append("def foo = bar(_._) with :> T")

local function what_it_could_be = |item| -> match {
  when item: contains("@") then "an email?"
  when item: startsWith("+33") then "a French phone number?"
  when item: startsWith("http://") then "a website URL?"
  otherwise "I have no clue, mate!"
}

function run = |context| {
  foreach (item in data()) {
    context: log(item + " => " + what_it_could_be(item))
  }
  return "Ok"
}
</script>

<script type="text/golo" id="call-me-maybe">module test

local function callMeMaybe = |func, default| {
  try {
    return func()
  } catch (e) {
    return default
  }
}

function run = |context| {

  let foo = "foo"
  context: log(callMeMaybe({ return foo + ":bar" }, "WTF"))
  context: log(callMeMaybe(-> foo + ":bar", "WTF"))

  context: log(callMeMaybe(^damn, "WTF"))
  context: log(callMeMaybe(-> raise("WTF"), "Ok"))
}

local function damn = -> "Damn"
</script>

<script type="text/golo" id="dynamic-object">module test

local function Person = |name, email| ->
  DynamicObject(): 
  name(name): 
  email(email):
  define("to_s", |this| -> this: name() + " <" + this: email() + ">")

function run = |context| {

  let julien = Person("Julien", "julien.ponge@insa-lyon.fr")
  context: log(julien: to_s())

  julien: name("Julien Ponge")
  context: log(julien: to_s())

  let ploping = DynamicObject(): define("plop", |this| -> "Plop!")
  context: log(julien: copy(): mixin(ploping): freeze(): plop())
}
</script>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/js/bootstrap.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.4/angular.min.js"></script>
<script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js"></script>
<script src="controllers.js"></script>

</html>
